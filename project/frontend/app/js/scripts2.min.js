$(document).ready(function () {
    $('body').on('click', '.vote_button', function () {
        var user_id = $(this).attr('user_id');
        $.post('/vote', {user_id: user_id}, function (data) {
            if (data.new_rating) {
                $('.player-active .player-img .count_check').text(data.new_rating);
                $('.count_check-mobile-page').text(data.new_rating); // на отдельной странице участника
            }
            $(".player").each(function () {
                $(this).find('.voted_button').show();
                $(this).find('.vote_button').hide();
            });
        });
    });

    function getCookie(name) {
        var matches = document.cookie.match(new RegExp(
            "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
    }

    var mens_offset = 0;
    $(".all_mens").click(function () {

        mens_offset += 9;
        var token = getCookie("csrftoken");
        $.post('', {offset: mens_offset, csrfmiddlewaretoken: token}, function (data) {
            console.log('load');
            if (data.length == 1) {
                $(".all_mens.more").hide();
            }
            $(".players").append(data);
            initParticipants();

            setTimeout(function () {
                // console.log('test');
                $(".more_info_about").addClass('invisible').css('opacity', 1);//.addClass('invisible');// css('display', 'none');
            }, 1200);

        });

    });


    if (location.opened_user_id) {
        setTimeout(function () {
            var id = location.opened_user_id;

            $("div.player[user_id=" + id + "]").addClass('player-active');
            $("div.player[user_id=" + id + "]").find('.more_info_about').show();
            $('html, body').animate({
                scrollTop: $("div.player[user_id=" + id + "]").find('.more_info_about').offset().top
            }, 1000);
        }, 400);
    }

    $(".form.hero").click(function(){
    	location.href='/form';
    });

     $('body').on('click','.no-auth-vote',function () {
        var link = $(this).data('link');
        if (typeof link == 'undefined'){
            link = '/form';
        }
        setNextAuthAddress(link);
        $('.wrapp_popup-login').fadeIn(300).css('display', 'flex');
        $('body').css('overflow','hidden');
    });
});

